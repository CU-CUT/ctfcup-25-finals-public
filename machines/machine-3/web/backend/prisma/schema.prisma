generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum GlobalRole {
  employee
  lead
  manager
  admin
}

enum ProjectRole {
  DEV
  QA
  TL
  PM
  PO
  DEVOPS
  ANALYST
}

enum AccessLevel {
  personal
  department
  public
}

enum Theme {
  light
  dark
}

model Department {
  id                  Int          @id @default(autoincrement())
  name                String
  code                String?
  parentDepartmentId  Int?
  parent              Department?  @relation("DepartmentHierarchy", fields: [parentDepartmentId], references: [id])
  children            Department[] @relation("DepartmentHierarchy")
  users               User[]
  projects            Project[]
}

model Project {
  id            Int                 @id @default(autoincrement())
  name          String
  code          String              @unique
  description   String
  departmentId  Int
  department    Department          @relation(fields: [departmentId], references: [id])
  memberships   ProjectMembership[]
  files         File[]
  createdAt     DateTime            @default(now())
}

model User {
  id            Int                 @id @default(autoincrement())
  email         String              @unique
  passwordHash  String
  fullName      String
  globalRole    GlobalRole          @default(employee)
  jobTitle      String
  departmentId  Int
  department    Department          @relation(fields: [departmentId], references: [id])
  managerId     Int?
  manager       User?               @relation("UserManager", fields: [managerId], references: [id])
  directReports User[]              @relation("UserManager")
  internalPhone String?
  voipSecret    String?
  avatarUrl     String?
  memberships   ProjectMembership[]
  files         File[]
  settings      UserSettings?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
}

model ProjectMembership {
  id        Int         @id @default(autoincrement())
  projectId Int
  userId    Int
  role      ProjectRole
  project   Project     @relation(fields: [projectId], references: [id])
  user      User        @relation(fields: [userId], references: [id])

  @@unique([projectId, userId])
}

model File {
  id           Int       @id @default(autoincrement())
  ownerId      Int
  owner        User      @relation(fields: [ownerId], references: [id])
  name         String
  mimeType     String
  sizeBytes    Int
  accessLevel  AccessLevel @default(personal)
  projectId    Int?
  project      Project?  @relation(fields: [projectId], references: [id])
  path         String
  createdAt    DateTime  @default(now())
}

model UserSettings {
  id     Int   @id @default(autoincrement())
  userId Int   @unique
  theme  Theme @default(light)
  user   User  @relation(fields: [userId], references: [id])
}
